<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - Events Controls</title>
		<meta charset="utf-8">
		<style>
			body {
				margin: 0px;
				color: #fff;
				font-family:Monospace;
				text-align: center;
				font-size: 15px;
				line-height: 30px;
				overflow: hidden;
			}
			#info {
				position: absolute;
				top: 0px; width: 100%;
				padding: 15px;
				z-index:100;
			}
		</style>
	</head>
	<body>
		<div id="info">
			<a href="http://threejs.org" target="_blank">three.js</a> EventsControls (look console)
		</div>

		<script src="https://threejs.org/build/three.min.js"></script>

		<script src="js/libs/stats.min.js"></script>

		<!--<script src="js/controls/OrbitControls.js"></script>-->	
		<script src="js/controls/EventsControls.js"></script>

		<script>


			var camera, scene, renderer, controls;

			init();
			animate();

			function init() {

				renderer = new THREE.WebGLRenderer( { antialias: true } ); 
				renderer.setClearColor( 0x6495ED );
				renderer.setSize( window.innerWidth, window.innerHeight );				
				document.body.appendChild( renderer.domElement );

				//

				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				stats.domElement.style.zIndex = 100;
				document.body.appendChild( stats.domElement );

				//

				camera = new THREE.PerspectiveCamera( 30, window.innerWidth / window.innerHeight, 1, 2000 );
				camera.position.set( 100, 400, 600 );
				camera.lookAt( new THREE.Vector3( 0, 0, 0 ) );
/*
				controls = new THREE.OrbitControls( camera, renderer.domElement );
				controls.rotateSpeed = 1 / 2;
				controls.noZoom = false;
				controls.zoomSpeed = 1.2;
				controls.staticMoving = true;
				controls.minPolarAngle = Math.PI / 3;
				controls.maxPolarAngle = Math.PI / 3;
*/
				scene = new THREE.Scene();

				var light = new THREE.DirectionalLight( 0xffffff, 1 );
				light.position.set( 0, 500, 1000 );
				scene.add( light );

				var light = new THREE.AmbientLight( 0x222222 );
				scene.add( light );


				// world

				var textureLoader = new THREE.TextureLoader();
				var texture = textureLoader.load( 'textures/checkerboard.jpg' );
				texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
				texture.repeat.set( 4, 4 );	texture.offset.set( 0.5, 0 );

				var Material = new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide } );
				var Geometry = new THREE.PlaneGeometry( 400, 400, 1, 1 );

				var checkerboard = new THREE.Mesh( Geometry, Material );
				checkerboard.position.y = - 1;
				checkerboard.rotation.x =  Math.PI / 2;
				scene.add( checkerboard );


				EventsControls1 = new EventsControls( camera, renderer.domElement );
				EventsControls1.map = checkerboard;

				EventsControls1.attachEvent( 'mouseOver', function () {

					this.container.style.cursor = 'pointer';

				});

				EventsControls1.attachEvent( 'mouseOut', function () {

					this.container.style.cursor = 'auto';

				});

				EventsControls1.attachEvent( 'dragAndDrop', function () {

					this.container.style.cursor = 'move';
					this.focused.position.y = this.previous.y;

				});

				EventsControls1.attachEvent( 'mouseUp', function () {

					this.container.style.cursor = 'auto';

				});

				var radius = 20, h = 16, segments = 36;
				var geometry = new THREE.CylinderGeometry( radius, radius, h, segments );
				var material = new THREE.MeshPhongMaterial( { color: 0xFFFFF0 } );

				var checker = new THREE.Mesh( geometry, material );

				checker.position.set( -175, h / 2, 175 );
				scene.add( checker ); EventsControls1.attach( checker );

				var checker = new THREE.Mesh( geometry, material );

				checker.position.set( -75, h / 2, 175 );
				scene.add( checker ); EventsControls1.attach( checker );

				var object3D = new THREE.Object3D;
				var mesh = new THREE.Mesh( geometry, material );
				object3D.add( mesh ); 
				var mesh = new THREE.Mesh( geometry, material );
				mesh.position.y = h; mesh.rotation.x = Math.PI / 2; mesh.rotation.z = Math.PI / 2;
				object3D.add( mesh );
				object3D.position.set( 25, h / 2, 175 );
				scene.add( object3D );  EventsControls1.attach( object3D );
	

				EventsControls2 = new EventsControls( camera, renderer.domElement );
				EventsControls2.map = checkerboard;

				EventsControls2.attachEvent( 'mouseOver', function () {

					this.container.style.cursor = 'pointer';

				});

				EventsControls2.attachEvent( 'mouseOut', function () {

					this.container.style.cursor = 'auto';

				});

				EventsControls2.attachEvent( 'dragAndDrop', function () {

					this.container.style.cursor = 'move';
					this.focused.position.y = this.previous.y;
					this.focused.position.x = 25 + 50 * Math.round( ( this.focused.position.x - 25 ) / 50 );
					this.focused.position.z = 25 + 50 * Math.round( ( this.focused.position.z - 25 ) / 50 );

				});

				EventsControls2.attachEvent( 'mouseUp', function () {

					var x = ( this.focused.position.x - 25 ) / 50;
					var z = ( this.focused.position.z - 25 ) / 50;

					var sum = Math.abs( ( x + z ) % 2 );
					if ( sum == 0 ) { this.returnPrevious() }
					this.container.style.cursor = 'auto';

				});


				var radius = 20, h = 16, segments = 36;
				var geometry = new THREE.CylinderGeometry( radius, radius, h, segments );
				var material = new THREE.MeshPhongMaterial( { color: 0x9B2D30 } );

				var checker = new THREE.Mesh( geometry, material ); checker.name = 'checker';
				checker.position.set( -125, h / 2, 125 );
				var checker2 = new THREE.Mesh( geometry, material ); checker2.name = 'checker2';
				checker2.position.set( -95, h / 2, 125 );
				
				scene.add( checker ); EventsControls2.attach( checker );
				scene.add( checker2 ); EventsControls2.attach( checker2 );
				
				var object3D = new THREE.Object3D; object3D.name = 'two checkers';
				var mesh = new THREE.Mesh( geometry, material.clone() );
				object3D.add( mesh ); mesh.name = 'bottom checker';
				var mesh = new THREE.Mesh( geometry, material.clone() );
				mesh.position.y = h; mesh.rotation.x = Math.PI / 2; mesh.rotation.z = Math.PI / 2;
				object3D.add( mesh );  mesh.name = 'top checker';
				object3D.position.set( -25, h / 2, 125 );				
			//	scene.add( object3D );  EventsControls2.attach( object3D );


				EventsControls3 = new EventsControls( camera, renderer.domElement );
				EventsControls3.map = checkerboard;

				EventsControls3.attachEvent( 'mouseOver', function () {

					this.container.style.cursor = 'pointer';

				});

				EventsControls3.attachEvent( 'mouseOut', function () {

					this.container.style.cursor = 'auto';

				});

				EventsControls3.attachEvent( 'dragAndDrop', function () {

					this.container.style.cursor = 'move';
					this.focused.position.y = 60;
					this.focused.position.x = 50 * Math.round( ( this.focused.position.x - 25 ) / 50 );
					this.focused.position.z = 50 * Math.round( ( this.focused.position.z - 25 ) / 50 );

				});

				EventsControls3.attachEvent( 'onclick', function () {

					var mesh = new THREE.Mesh( this.focused.geometry.clone(), this.focused.material.clone() );
					mesh.position.copy( this.focused.position );
					mesh.material.transparent = true; mesh.material.opacity = 0.7;
					scene.add( mesh );
					this.setFocus( mesh );

				});

				EventsControls3.attachEvent( 'mouseUp', function () {

					this.focused.material.transparent = false;
					this.container.style.cursor = 'auto';

				});					


				var textureLoader = new THREE.TextureLoader();
				var texture = textureLoader.load( 'textures/crate.gif' );
				var geometry = new THREE.PlaneGeometry( 100, 160, 16, 16 );
				texture.wrapS = texture.wrapT = THREE.RepeatWrapping;

				var material = new THREE.MeshLambertMaterial( { map: texture , side: THREE.DoubleSide } );;

				var fence = new THREE.Mesh( geometry, material );

				fence.position.set( -175, 40, 75 ); fence.scale.set( 1/2, 1/2, 1/2 );
				scene.add( fence ); EventsControls3.attach( fence );


				// Snowman


				EventsControls4 = new EventsControls( camera, renderer.domElement );

				EventsControls4.attachEvent( 'onclick', function () {

					console.log('/--------------------/');
					console.log( 'this.focused.name: ' + this.focused.name );
					if ( this.focusedChild != null ) console.log( 'this.focusedChild.name: ' + this.focusedChild.name )
						else  console.log( 'this.focusedChild is null' );

					console.log( 'this.event.distance: ' + this.event.distance );
					console.log( 'this.event.point: (' + this.event.point.x + ', ' + this.event.point.y + ', ' + this.event.point.z + ')' );

				});


				var man = createSnowman(); 
				man.position.set( 175, 0, 75 );
				scene.add( man );

				EventsControls4.attach( man );
				
				
/*
				EventsControls5 = new EventsControls( camera, renderer.domElement );
				EventsControls5.attach( checkerboard );

				EventsControls5.attachEvent( 'mouseOver', function () {

					controls.enabled = false;
					controls.target0.copy( controls.target );
					controls.position0.copy( controls.object.position );

				});

				EventsControls5.attachEvent( 'mouseOut', function () {

					controls.reset();
					controls.target.copy( controls.target0 );
					controls.object.position.copy( controls.position0 );
					controls.update();
					controls.enabled = true;

				});
				*/

			}

			function createSnowman() {

					var Snowman = new THREE.Object3D();

					var	material =  new THREE.MeshBasicMaterial({color: 0x33CCFF});
					var geometry = new THREE.SphereGeometry( 30, 36, 36 );
					var sphere1 = new THREE.Mesh( geometry, material);
					sphere1.position.set( 0, 30, 0 ); sphere1.name = 'sphere1';
					Snowman.add( sphere1 );


					var	material =  new THREE.MeshBasicMaterial({color: 0x00edff});
					var geometry = new THREE.SphereGeometry( 22, 36, 36 );
					var sphere2 = new THREE.Mesh( geometry, material);
					sphere2.position.set( 0, 70, 0 ); sphere2.name = 'sphere2';
					Snowman.add( sphere2 ); 


					var	material =  new THREE.MeshBasicMaterial({color: 0xafeeee});
					var geometry = new THREE.SphereGeometry( 16, 36, 36 );
					var sphere3 = new THREE.Mesh( geometry, material);
					sphere3.position.set( 0, 103, 0 );	sphere3.name = 'sphere3';
					Snowman.add( sphere3 );

	
					var	material =  new THREE.MeshBasicMaterial({color: 0x1560bd});
					var geometry = new THREE.SphereGeometry( 8, 16, 16 );
					var sphere4 = new THREE.Mesh( geometry, material);
					sphere4.position.set( -25, 78, 0 );		
					Snowman.add( sphere4 ); sphere4.name = 'hand right';
	
					sphere5 = new THREE.Mesh( geometry, material);	
					sphere5.position.set( 25, 78, 0 );	
					Snowman.add( sphere5 ); sphere5.name = 'hand left';

					// нос

					var	material = new THREE.MeshLambertMaterial( {color: 0xf36223} );
					var geometry = new THREE.CylinderGeometry( 1, 4, 20, 16 );
					var nose = new THREE.Mesh( geometry, material);
					nose.position.set(0, 101, 23); nose.rotation.x = Math.PI / 2;
					nose.name = 'nose';
					Snowman.add( nose );

					// ведро
   
					var	material = new THREE.MeshLambertMaterial({color: 0x6600ff}); 
					var geometry = new THREE.CylinderGeometry( 12, 17, 30, 24 ); 
					var bucket = new THREE.Mesh( geometry, material);	 		
					bucket.position.set(0, 125, -6 );  bucket.rotation.x = -Math.PI/11;
					Snowman.add( bucket ); bucket.name = 'bucket';

					// глаза
					var	material = new THREE.MeshLambertMaterial({color: 0x000000});
					var geometry = new THREE.SphereGeometry( 3, 25, 5 );
					var eye1 = new THREE.Mesh( geometry, material);
					eye1.position.set( -8, 105, 13 ); eye1.name = 'eye1';
					Snowman.add( eye1 );

					var eye2 = new THREE.Mesh( geometry, material);	
					eye2.position.set( 8, 105, 13 ); eye2.name = 'eye2';
					Snowman.add( eye2 );

					// рот
					var	material = new THREE.MeshBasicMaterial({color: 0x560319});
					var geometry = new THREE.CircleGeometry( 5, 5, 0, Math.PI );
					var mouth = new THREE.Mesh( geometry, material);
					mouth.rotation.z = Math.PI;
					mouth.position.set( 0, 97, 13 );
					Snowman.add( mouth ); 

					Snowman.name = 'Snowman';
					return Snowman;

			}


			function animate() {

					requestAnimationFrame(animate);
					render();

			}


			function render() {

					stats.update();
					//controls.update();
					renderer.render(scene, camera);

			}

		</script>

	</body>
</html>
